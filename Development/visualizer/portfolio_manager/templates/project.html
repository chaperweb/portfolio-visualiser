{% extends "base.html" %}

{# TITLE HERE #}
{% block title %}
Projects | {{project.name}}
{% endblock %}

{# CSS HERE #}
{% block css %}
{% load static %}
<link rel="stylesheet" href="{% static "portfolio_manager/css/sidebar.css" %}">
<link rel="stylesheet" href="{% static "portfolio_manager/css/admin_tools.css" %}">
{% endblock %}

{% block javascript %}
{% load static%}
<script src="{% static "portfolio_manager/js/modify_project.js" %}"></script>
{% endblock %}

{# CONTENT HERE #}
{% block content %}
{% load tz %}
{% load project_tags %}
<!-- Sidebar -->
<div class="sidebar navbar-fixed-left navbar-inverse xs-hidden col-md-2">
  <ul class="nav navbar-nav">
    <!-- Press this list item to show all the projects -->
    <li data-toggle="collapse" data-target="#projects" class="navbar-toggle sidebar-item">Projects</li>
    <li>
      <!-- Expandable list with all the projects -->
      <div id="projects" class="collapse in">
        <ul class="nav">
          {% for p in projects %}
            <li><a class="sidebar-subitem" href="/projects/{{p.pk}}">{{p.name}}</a></li>
          {% endfor %}
        </ul>
      </div>
    </li>
  </ul>
</div>
<!-- /sidebar -->

<!-- Page Content -->
<div id="page-content-wrapper" class="container col-lg-10">
  <div class="col-md-8 col-md-offset-2">
    <div class="title text-center" id="project-name">
      <b>{{ project.name }}</b>
    </div>
    {% for dim_type, dim_list in dimensions.items %}
      <h4><u>{{ dim_type | ct_name | upper }} FIELDS: </u></h4>
      <!-- Include the modal for the type -->
      {% include "modals/modify_modal.html" with type=dim_type|get_type %}

      <!-- Loop through all the fields and add them to the list -->
      <div class="panel-group" id="project-dimension-panels">
      {% for dim_name, dim_obj in dim_list.items %}
        <div class="panel panel-default">
          <div class="panel-heading row"
              data-toggle="collapse"
              href="#{{dim_name}}-panel"
              aria-controls="#{{dim_name}}-panel"
              aria-expanded="false">
            <!--  Triangles  -->
            <div class="col-lg-1">
              <span class="glyphicon glyphicon-triangle-bottom" aria-hidden="true"></span>
              <span class="glyphicon glyphicon-triangle-top" aria-hidden="true"></span>
            </div>
            <!--  Name of dimension  -->
            <div class="col-lg-2">
              {{ dim_name }}
            </div>
            <!--  Value of dimension  -->
            <div id="{{dim_name}}" class="col-lg-3 col-lg-offset-3">
              {{ dim_obj | stringformat:"s" }}
            </div>
            <!--  Modify button  -->
            <div class="col-md-1 pull-right">
              <button class="btn btn-xs btn-default modify-button"
                  data-type="{{ dim_type | get_type }}"
                  data-field="{{ dim_obj.id }}"
                  data-value="{{ dim_obj | stringformat:"s" }}"
                  data-multiple="{{ dim_type | get_type | is_type:"multiple" }}"
                  data-toggle="modal"
                  data-target="#modify-{{ dim_type | get_type }}-modal">
                Modify
              </button>
            </div>
          </div>
          <!--  The history box  -->
          <div id="{{dim_name}}-panel" class="panel-collapse panel-body collapse row">
            <table class="table">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Value</th>
                </tr>
              </thead>
              <tbody>
                {% for history_obj in dim_obj.history.all %}
                  {% if forloop.counter < 6 %}
                    <tr>
                      <td>{{history_obj.history_date}}</td>
                      <td>{{history_obj.value}}</td>
                    </tr>
                  {% endif %}
              	{% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      {% endfor %}
      </div>
    {% endfor %}
{% endblock %}
